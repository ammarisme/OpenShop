@{
    ViewBag.Title = "Employees";
}

<div class="col-md-12">
    <!-- Modal -->
    <div class="modal fade" id="myModal" role="dialog" data-backdrop="false">
        <div class="modal-dialog">
            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">Close</button>
                    <h4 class="modal-title"></h4>
                </div>
                <div class="modal-body">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">OK</button>
                </div>
            </div>

        </div>
    </div>
</div>
@* Employee Creation Form *@
<div class="col-md-6 col-sm-12">
    <form action="/api/Employees/AddEmployee" id="employee-form" method="POST">
        <div id="name-group" class="form-group">
            @*
                                        autogenerated :
                EmployeeId
                Status
            *@

            @*FirstName*@
            <label for="date">FirstName</label>
            <input type="text" name="FirstName" class="form-control" />

            @*LastName*@
            <label for="date">LastName</label>
            <input type="text" name="LastName" class="form-control" />

            @*Designation*@
            <label for="date">Designation</label>
            <input type="text" pattern="[A-za-z]" name="Designation" class="form-control" />

            @*Remark*@
            <label for="date">Remark</label>
            <input type="text" name="Remark" class="form-control" />

            @*PhoneNumber*@
            <label for="date">PhoneNumber</label>
            <input type="number" pattern="[0-9+]" name="PhoneNumber" class="form-control" />

            @*Address*@
            <label for="date">Address</label>
            <input type="text" name="Address" class="form-control" />

        </div>
    </form>
    <button class="btn btn-success" id="create-update-employee-button">Create / Update Employee</button>
</div>

@* show the employee list from the database *@
<div class="col-md-12 col-sm-12">
    <table id="employees-table" class="display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>EmployeeId</th>
                <th>FirstName</th>
                <th>LastName</th>
                <th>Designation</th>
                <th>Status</th>
                <th>Remark</th>
                <th>PhoneNumber</th>
                <th>Address</th>
                <th>EmployeeFullName</th>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr>
                <th>EmployeeId</th>
                <th>FirstName</th>
                <th>LastName</th>
                <th>Designation</th>
                <th>Status</th>
                <th>Remark</th>
                <th>PhoneNumber</th>
                <th>Address</th>
                <th>EmployeeFullName</th>
            </tr>
        </tfoot>
    </table>
</div>


<script src="~/Scripts/bootstrap-datetimepicker.min.js"></script>
<script>

    /// Initiating the employees table
    var employeesTable = $("#employees-table").DataTable({
        "columns": [
                { "data": "EmployeeId" },
                { "data": "FirstName" },
                { "data": "LastName" },
                { "data": "Designation" },
                { "data": "Status" },
                { "data": "Remark" },
                { "data": "PhoneNumber" },
                { "data": "Address" },
                { "data": "EmployeeFullName" }
        ]
    }); //

    var employeeId = null;
    var employeeForm = $("#employee-form");

    var onEmployeeSelected = function () {
        var tableIndex = getTableSelectedRowIndex($("#employees-table"));

        var EmployeeData = employeesTable.row(tableIndex).data();

        setFormValues(employeeForm, EmployeeData);

        employeeId = getTableSelectedRowKey($("#employees-table"));
    }
    updateTableFromApi(employeesTable, "/api/Employees/GetEmployees", onEmployeeSelected);

    $("#create-update-employee-button").on('click', function () {
        var FormData = getFormValues('employee-form');
        FormData.EmployeeId = employeeId; // this column will say if this employee already  exist in db or not
        $.ajax({
            type: 'post',
            url: "/api/Employees/AddOrUpdateEmployee",
            data: JSON.stringify(FormData),
            dataType: 'json',
            contentType: 'application/json',
            success: function (data) {
                employeesTable.clear();
                updateTableFromApi(employeesTable, "/api/Employees/GetEmployees", onEmployeeSelected);
            }
        }
            );
    });

</script>